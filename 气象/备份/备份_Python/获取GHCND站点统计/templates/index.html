<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Weather Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container">
        <h1>NOAA Weather Data Interface</h1>

        <!-- PART 1: PARAMETERS -->
        <div class="section">
            <h2>1. Parameters</h2>
            
            <div class="param-row">
                <label>Station Search:</label>
                <input type="text" id="stationInput" list="stationOptions" 
                       placeholder="Type Name or ID..." oninput="searchStations()" 
                       autocomplete="off" style="width: 300px;">
                <datalist id="stationOptions"></datalist>
                <input type="hidden" id="stationId" value="RSM00030565">
            </div>

            <div class="param-row">
                <label>Date Range:</label>
                <input type="date" id="startDate" value="1800-01-01">
                <span>to</span>
                <input type="date" id="endDate" value="2027-01-01">
            </div>

            <div class="param-row">
                <label>Month Focus:</label>
                <select id="monthFilter">
                    <option value="0">Full Year</option>
                    <option value="winter_3">Winter 3 Months (Dec-Feb)</option>
                    <option value="summer_3">Summer 3 Months (Jun-Aug)</option>
                    <option value="1">January</option><option value="2">February</option>
                    <option value="3">March</option><option value="4">April</option>
                    <option value="5">May</option><option value="6">June</option>
                    <option value="7">July</option><option value="8">August</option>
                    <option value="9">September</option><option value="10">October</option>
                    <option value="11">November</option><option value="12">December</option>
                </select>
            </div>

            <!-- NEW: HEMISPHERE -->
            <div class="param-row">
                <label>Hemisphere:</label>
                <div class="radio-group">
                    <input type="radio" name="hemisphere" value="north" checked> North
                    <input type="radio" name="hemisphere" value="south"> South
                </div>
            </div>

            <div class="param-row">
                <label>Period Mode:</label>
                <div class="radio-group">
                    <input type="radio" name="period" value="p1" checked> Period 1 (July 16 - July 15)
                    <input type="radio" name="period" value="p2"> Period 2 (Jan 16 - Jan 15)
                </div>
            </div>

            <div class="divider"></div>
            
            <div class="param-grid">
                <div class="thresh-box">
                    <strong>TMIN Threshold</strong>
                    <input type="number" id="tminVal" value="-40" placeholder="Value (C)">
                    <select id="tminDir"><option value="lte">&le;</option><option value="gte">&ge;</option></select>
                </div>
                <div class="thresh-box">
                    <strong>TAVG Threshold</strong>
                    <input type="number" id="tavgVal" value="-35" placeholder="Value (C)">
                    <select id="tavgDir"><option value="lte">&le;</option><option value="gte">&ge;</option></select>
                </div>
                <div class="thresh-box">
                    <strong>TMAX Threshold</strong>
                    <input type="number" id="tmaxVal" value="-30" placeholder="Value (C)">
                    <select id="tmaxDir"><option value="lte">&le;</option><option value="gte">&ge;</option></select>
                </div>
            </div>

            <button class="submit-btn" onclick="fetchData()">Get Data & Statistics</button>
            <div id="loading" class="hidden">Loading data...</div>
            <div id="errorMsg" class="error"></div>
        </div>

        <!-- PART 2: STATISTICS -->
        <div class="section">
            <h2>2a. Global Statistics</h2>
            <table class="stats-table">
                <thead><tr><th>Type</th><th>Min (C)</th><th>Avg (C)</th><th>Max (C)</th><th>Days Matching Threshold</th></tr></thead>
                <tbody>
                    <tr><td><strong>TMIN</strong></td><td id="stat-tmin-min">-</td><td id="stat-tmin-avg">-</td><td id="stat-tmin-max">-</td><td id="stat-tmin-count">-</td></tr>
                    <tr><td><strong>TAVG</strong></td><td id="stat-tavg-min">-</td><td id="stat-tavg-avg">-</td><td id="stat-tavg-max">-</td><td id="stat-tavg-count">-</td></tr>
                    <tr><td><strong>TMAX</strong></td><td id="stat-tmax-min">-</td><td id="stat-tmax-avg">-</td><td id="stat-tmax-max">-</td><td id="stat-tmax-count">-</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>2b. Period Averages (Summary)</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Avg of (Min TMIN per Period)<br><span class="header-note">Val (Used/Total)</span></th>
                        <th>Avg of (Min TMAX per Period)<br><span class="header-note">Val (Used/Total)</span></th>
                        <th>Avg of (Max TMIN per Period)<br><span class="header-note">Val (Used/Total)</span></th>
                        <th>Avg of (Max TMAX per Period)<br><span class="header-note">Val (Used/Total)</span></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td id="sum-avg-min-tmin" class="summary-cell">-</td>
                        <td id="sum-avg-min-tmax" class="summary-cell">-</td>
                        <td id="sum-avg-max-tmin" class="summary-cell">-</td>
                        <td id="sum-avg-max-tmax" class="summary-cell">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>2c. Period Details (By Range)</h2>
            <div style="max-height: 300px; overflow-y: auto;">
                <table class="stats-table" id="periodStatsTable">
                    <thead>
                        <tr>
                            <th>Period Range</th>
                            <th>Min TMIN</th>
                            <th>Max TMIN</th>
                            <th>Min TMAX</th>
                            <th>Max TMAX</th>
                            <th>Days (TMIN)</th>
                            <th>Days (TAVG)</th>
                            <th>Days (TMAX)</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- PART 3: RECORD LIST -->
        <div class="section">
            <h2>3. Record List (Top 500 from Sorted Result)</h2>
            <table class="data-table" id="recordsTable">
                <thead>
                    <tr>
                        <th onclick="triggerServerSort('ID')">ID &#8645;</th>
                        <th onclick="triggerServerSort('DATE')">Date &#8645;</th>
                        
                        <th class="filter-header" style="position: relative;" onclick="toggleElementFilter(event)">
                            <span>Element &#9662;</span>
                            <div id="elementFilterDropdown" class="filter-dropdown hidden" onclick="event.stopPropagation()">
                                <label><input type="checkbox" value="TMIN" checked onchange="applyElementFilter()"> TMIN</label>
                                <label><input type="checkbox" value="TAVG" checked onchange="applyElementFilter()"> TAVG</label>
                                <label><input type="checkbox" value="TMAX" checked onchange="applyElementFilter()"> TMAX</label>
                            </div>
                        </th>
                        
                        <th onclick="triggerServerSort('DATA_VALUE')">Data Value (C) &#8645;</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>