<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arguments Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .control-group { 
            margin-bottom: 20px; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px;
            background: #f9f9f9;
        }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 8px 15px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background-color: #0056b3; }
        #result-box { margin-top: 20px; padding: 15px; background: #e8f5e9; border: 1px solid #4caf50; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Python Functions with Arguments</h1>

    <div class="control-group">
        <h3>第一步</h3>
        <button onclick="runPython('btn_scrape')">爬取WMO</button>
    </div>

    <!-- 1. Simple Function (No Args) -->
    <div class="control-group">
        <h3>1. No Arguments</h3>
        <button onclick="runPython('btn_time')">Get Time</button>
    </div>

    <!-- 2. Function with 1 Argument -->
    <div class="control-group">
        <h3>2. Greet User (1 Arg)</h3>
        <input type="text" id="input_name" placeholder="Enter your name">
        <!-- We pass an object {name: value} to the JS function -->
        <button onclick="runPython('btn_greet', { name: getValue('input_name') })">
            Say Hello
        </button>
    </div>

    <!-- 3. Function with 2 Arguments -->
    <div class="control-group">
        <h3>3. Calculator (2 Args)</h3>
        <input type="number" id="num_a" placeholder="Number A" style="width: 80px;">
        <span>+</span>
        <input type="number" id="num_b" placeholder="Number B" style="width: 80px;">
        
        <!-- We pass {a: val, b: val} -->
        <button onclick="runPython('btn_add', { a: getValue('num_a'), b: getValue('num_b') })">
            Calculate Sum
        </button>
    </div>

    <div id="result-box">Results will appear here...</div>

    <script>
        // Helper to get value from input by ID
        function getValue(id) {
            return document.getElementById(id).value;
        }

        async function runPython(funcKey, argumentsObj = {}) {
            const resultBox = document.getElementById('result-box');
            resultBox.innerText = "Processing...";
            resultBox.style.color = "gray";

            try {
                // SEND DATA TO FLASK
                const response = await fetch(`/execute_function/${funcKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // We wrap the arguments in a key called 'args'
                    body: JSON.stringify({ args: argumentsObj })
                });

                const data = await response.json();

                if (data.status === "success") {
                    resultBox.innerText = "Success: " + data.result;
                    resultBox.style.color = "green";
                } else {
                    resultBox.innerText = "Error: " + data.message;
                    resultBox.style.color = "red";
                }
            } catch (error) {
                console.error(error);
                resultBox.innerText = "System Error (Check console)";
            }
        }
    </script>
</body>
</html>